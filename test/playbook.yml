---

- hosts: localhost

  tasks:

  - name: Print test_backend
    ansible.builtin.debug:
      msg: "test_backend: '{{ test_backend }}'"

  - name: Not implemented
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-local
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-ni"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_backup_location: "{{ playbook_dir }}/.backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-ni"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'Not implemented'
    when: test_backend ==  'Not implemented'

  - name: Local disk
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-local
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-local"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_backup_location: "{{ playbook_dir }}/.backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-local"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'Local disk'
    when: test_backend == 'Local disk'

  - name: Backblaze B2
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-b2
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-b2"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-b2"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'Blackblaze B2'
    when: test_backend == 'Blackblaze B2'

  - name: SSH/SFTP Password
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-ssh_password
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-ssh_password"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-ssh_password"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'SSH/SFTP Password'
    when: test_backend == 'SSH/SFTP Password'

  - name: SSH/SFTP Keyfile
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-ssh_key
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-ssh_key"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-ssh_key"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'SSH/SFTP Keyfile'
      duplicacy_autobackup_secret_file_path: "{{ playbook_dir }}/.secret"
    when: test_backend == 'SSH/SFTP Keyfile'

  - name: Onedrive Keyfile
    ansible.builtin.include_role:
      name: ../../ansible-role-duplicacy-autobackup
    vars:
      duplicacy_autobackup_container_name: duplicacy-onedrive
      duplicati_autobackup_script_file_path: "{{ playbook_dir }}/.srv-onedrive"
      duplicacy_autobackup_backup_name: "duplicacy-backup"
      duplicacy_autobackup_repository: "{{ playbook_dir }}/repository"
      duplicacy_autobackup_duplicacy_init_options: '-repository /repository'
      duplicacy_autobackup_backup_encryption_key: encryption_key
      duplicacy_autobackup_working_directory: "{{ playbook_dir }}/.data-onedrive"
      duplicacy_autobackup_backup_immediately: 'yes'
      duplicacy_autobackup_storage_backend: 'Onedrive'
      duplicacy_autobackup_secret_file_path: "{{ playbook_dir }}/.secret"
    when: test_backend == 'Onedrive'

...
